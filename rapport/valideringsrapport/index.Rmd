---
params:
  nyTitle: "Sykehusnavn"
  nyDate: !r Sys.Date()
  nySubTitle: "Tidsperioden"
title: "`r params$nyTitle`"
date: "`r params$nyDate`"
subtitle: "`r params$nySubTitle`"
documentclass: book
site: bookdown::bookdown_site
header-includes:
- \usepackage{booktabs}
- \usepackage{longtable}
- \usepackage{array}
- \usepackage{multirow}
- \usepackage{wrapfig}
- \usepackage{float}
- \usepackage{colortbl}
- \usepackage{pdflscape}
- \usepackage{tabu}
- \usepackage{threeparttable}
- \usepackage{threeparttablex}
- \usepackage[normalem]{ulem}
- \usepackage{makecell}
- \usepackage[T1]{fontenc}
- \usepackage{geometry}
- \geometry{a4paper, total={6in,8in},}
- \usepackage[utf8]{inputenc}
- \renewcommand{\figurename}{Figur}
- \renewcommand{\tablename}{Tabell}

output:
  bookdown::gitbook:
    split_by: section
    download: ["pdf"]
  bookdown::pdf_document2:
    keep_tex: no
    toc: no
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r test, eval=F, include=F }
## Tilgang til K sensitivt
inspak <- function(pkg){
  nypkg <- pkg[!(pkg %in% installed.packages()[, "Package"])]
  if (length(nypkg)) install.packages(nypkg, dependencies = TRUE, repos = "http://cran.rstudio.com")
  sapply(pkg, require, character.only = TRUE)
}

pkgs = c("data.table", "stringi", "validate", "ggplot2", "lubridate", "readxl", "sqldf", "huxtable")

inspak(pkgs)

## Setup
## -------
# source(file.path(kilde, "setup.R", fsep = "\\"))
## Hente data for årskontroll 2018
## --------------------------------
# dt2018 <- readRDS(file.path("../.."), "validert_arskontroll2018.rds")
dataSti <- "K:\\Sensitivt\\Forskning02\\Barnediabetesregisteret_2015-5739\\Barnediabetes og kvalitet\\Datafiler\\2018"
ars2018 <- readRDS(file.path(dataSti, "validert_arskontroll2018.rds", fsep = "\\"))
```

```{r key}
antall.pas <- dim(ars2018)[1]
```


## Typer diabetes {-}

```{r diabtype}
source("./analyse/type_diabetes.R")
pros.syk <- round((antall.lokal / antall.pas) * 100, digits = 1)
```
Antall registerte pasienter med diabetes (alle typer) for `r hospTitle` er **`r antall.lokal`** pasienter. Dette tilsvarer **`r pros.syk`** prosent av total
antall registerte pasienter i hele landet som har tatt årskontroll i 2018 dvs. **`r antall.pas`** pasienter. Antall pasienter for de forskjellige diabetes typer fordelt på kjønn er som følgende:


```{r diabetes, eval=F}
if (knitr::is_html_output()){
  kable(diab.lokal, format = "html") %>%
    kable_styling(bootstrap_options = c("striped", "hover")) %>%
    row_spec(3, bold = T, color = "black", background = "#c0c0c0")
}

## if (knitr::opts_knit$get('rmarkdown.pandoc.to') == "latex"){
##   kable(diab.nasj)
## }

if (knitr::is_latex_output()){
##   kable(diab.nasj, format = "latex", booktabs = T) %>%
##     kable_styling(latex_options = "striped")
  kable(diab.lokal, "latex", booktabs = T) %>%
    kable_styling(latex_options = "striped") %>%
    row_spec(3, bold = T, color = "black", background = "#c0c0c0")
}
```

```{r r huxtabdt, eval=T, echo=F}
hTB <- as_hux(diab.lokal, add_colnames = TRUE)
## caption(hTB) <- "Antall pasienter med alle type diabetes"

hTB <- hTB %>%
  set_bottom_border(1,, TRUE) %>%
  set_bold(1,, TRUE) %>%
  set_top_border(4,, TRUE) %>%
  map_background_color(by_rows("grey95", "white"))

width(hTB) <- 0.6
hTB

```

***Videre analyser inkludere KUN pasienter med Type 1 diabetes (n = `r dim(lok2018dt1)[1]`)***

## Pasient-karakteristika {-}

Pasient karakteristika for alle med diabetes type 1 (n = `r dim(lok2018dt1)[1]`) vises i tabellen nedenfor. Antall pasienter kan variere pga. manglende data.

```{r}
source("./analyse/karakter.R")

lastLine <- dim(kar.tab)[1] + 1

kar.htab <- as_hux(kar.tab, add_colnames = TRUE)

kar.htab <- kar.htab %>%
  set_bottom_border(1,, TRUE) %>%
  set_bold(1,, TRUE) %>%
  set_bottom_border(lastLine,, TRUE) %>%
  map_background_color(by_rows("grey95", "white")) %>%
  set_position("left")

width(kar.htab) <- 0.6
kar.htab
```

## Nasjonalitet {-}
Nasjonalitet er definert etter hvor barnets foreldre er født. Er en eller begge
foreldrene født i et av de nordiske landene kategoriseres barnet som
Nordisk. Manglende data om nasjonalitet blir kategorisert som *ukjent*. Antall og
andel for nasjonalitet fordelt på kjønn er som følgende:

```{r nasj}
source("./analyse/nasjonal.R")

lastLine <- dim(barnWt)[1] + 1

nas.htab <- as_hux(barnWt, add_colnames = TRUE)

nas.htab <- nas.htab %>%
  set_bottom_border(1,, TRUE) %>%
  set_bold(1,, TRUE) %>%
  set_bottom_border(lastLine,, TRUE) %>%
  map_background_color(by_rows("grey95", "white")) %>%
  set_position("left")

width(nas.htab) <- 0.7
nas.htab
```

## Andel kompletthet {-}

Figuren viser andel kompletthet av noen utvalgte variabler. For *fysisk aktivitet*
regner vi kompletthet på alle pasienter fra og med 6 år.

```{r komplett, fig.height=4}
source("./analyse/kompletthet.R")
fig.komp
```

## Undersøkelser utført {-}

Tabellen nedenfor viser antall og andel undersøkelser utført siste året.

```{r undersk}
source("./analyse/undersokelse.R")
und.htab
```

## ISPAD guidelines {-}

Tabellen viser antall og andel pasienter undersøkt i henhold til ISPAD guidelines
(2014) som definerer at pasienter er eldre enn 10 år med 2 års diabetesvarighet eller yngre enn 10 år med 5 års diabetesvarighet.

```{r ispad}
source("./analyse/ispadguide.R")
width(isp.htab) <- 0.7
isp.htab
```

## Blodtrykk {-}

```{r bp-data}
source("./analyse/blodtrykk.R")
```

Det er **`r pbValid`** pasienter har komplett data for *alder, høyde, vekt, blodtrykk
systolisk* og *blodtrykk diastolisk*. Tabellen nedenfor viser fordelingen for
pasienter med blodtrykk mellom 90 og 94 persentil og pasienter med blodtrykk mer eller lik 95 persentil. Analysen inkluderer bare pasienter fra og med 2 år.

```{r bp}
width(bp.htab) <- 0.8
bp.htab
```




