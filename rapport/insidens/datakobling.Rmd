---
title: "Datakobling for fylke, SSB og BDR"
output:
  pdf_document:
    toc: yes
  html_document:
    toc: yes
    toc_float:
      collapsed: yes
date: "`r format(Sys.time(), '%d %B %Y')`"
---


# Oppsett

Oppsett for Rmarkdown.

```{r r setup, include=F}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, eval = FALSE)
```

# Load pakker


```{r}
list.of.packages <- c("data.table", "stringr", "lubridate", "shiny", "flexdashboard",
                      "leaflet","ggplot2","dplyr","sf","ggrepel", "tmap", "mapview")

new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages, repos = "https://cloud.r-project.org/")
sapply(list.of.packages, require, character.only = TRUE)

```

# Load Data

Disse er ferdig behandlet data fra prossesen nedenfor begynner fra [SSB](#ssb).


```{r}
## Data path
dataSti <- "~/avid/bdr"

#Diabetes pasienter
DT2018 <- readRDS(file.path(dataSti, "alleDiabetes2018_med_fylkeid.Rds"))

#Annonym pasientlister
## DTannon <- readRDS("dtAnnonym.rds")
DTannon <- readRDS("DTannonHF.rds") #med HF

#Norges befolkning
## ssbKart <- readRDS("SSBmedMapID.Rds")
ssbKart <- readRDS( "SSBmedHFogKartID.rds")

#Kart med fylkeID som i SSB
NorgeMapFylke <- readRDS("NorgeMapFylkeID.Rds")
#Kart med helseregion
NorgeHFReg <- readRDS("kartHF.rds")

rhfID <- readRDS("hfIDList.rds")
fylID <- readRDS("FylkeID.rds")

```



# SSB {#ssb}

Basis data for befolkningen hentet fra
[SSB](https://www.ssb.no/statbank/list/folkemengde/ "befolkning"). Når filen er
lastet ned så følgende gjøres for å lage fylkes id nr. Sjekk struktur datasettet at
de som skal være numerisk er ikke i string format.


```{r }
## norsk baren 1-18 år
norskBF18 <- fread("N2018_Norge_1_18.csv", header = TRUE, encoding = "Latin-1")

## Extract Alder
norskBF18[, age := stringr::str_extract(alder, "\\d+")]
## Extract tall for fylke med gsub
norskBF18[, fylkeID := as.integer(gsub("([0-9]+).*$", "\\1", region))]

## Kjonn
norskBF18[.(kjønn = c("Menn", "Kvinner"), to = 1:2), on = "kjønn", kjonn := i.to]

## Alder
norskBF18[, age := as.integer(age)]

## Variabel 'Personer 2018' bytt til 'N'
nbf <- grep("^Personer", names(norskBF18), value = T) #antall befolkningen
norskBF18[, N := get(nbf)]

## str(norskBF18)

## Beholder bare de under 15 år
norskBF15 <- subset(norskBF18, age < 15)
## saveRDS(norskBF15, "NorgeBF_und15.Rds")
norskBF <- readRDS("NorgeBF_und15.Rds")
```

# Diabetes data 

Raw data kommer fra årsrapport og nyoppdaget. De skal slås sammen for prevalens mens
insidens brukes bare nyoppdaget minus antall årsrapport i nevnet (denominator). Bruke
`selectdiab()` funksjon for å kategorisere diabetes type på en kolonne.


## Funksjons

For å hente bare relevant data og kategorisere diabetes type.


```{r}

selectdiab <- function(x){

  ## Demografisk variabler
  demoVar <-  c("PasientID", "Pnr", "hospital", "hospID", "hosKort", "alder", "Kjonn")

  ## diabetes variabler
  diabetesVar = c("diabetes_Type1", "diabetes_Type2", "diabetes_Mody", "diabetes_Kir62", "diabetes_SekDiabetes", "diabetes_AnnenDiabetes", "diabetes_UkjentDiabetes")

  ## lage subset
  diabDT <- x[, c(demoVar, diabetesVar), with = F]


  ## --- Pasienter uten diagnoser ----
  diabDTx <- copy(diabDT)
  diabDTx[, (diabetesVar) := lapply(.SD, function(x) ifelse(x == "Ja", 1, 0)), .SDcols = diabetesVar]

  diabDTx[, diaSum := sum(.SD, na.rm = TRUE), .SDcols = diabetesVar, by = Pnr]

  ## diabDTx[diaSum == 0, .(Pnr, hosKort)]

  ## Lage en long dataset
  diabLg <- melt(data = diabDT,
                 id.vars = demoVar,
                 measure.vars = diabetesVar,
                 variable.name = "diabType",
                 value.name = "janei")


  ## Omkode diabetes type til tall fra 1 til 7
  diabLg[.(janei = "Ja", diabType = diabetesVar, to = 1:7), on = c("janei", "diabType"), dbt := i.to]

  ## Beholder bare de som svarte Ja
  diabJa <-  diabLg[janei == "Ja", ]

  ## rekode annen type diabetes
  ## 1 = DT1, 2 = DT2, 3 = Mody, 4 = Annen type
  diabJa[, dbtype := dbt][dbt > 3, dbtype := 4]

  return(diabJa)

}

```


## Antall pasienter

Diabetes data for 2018. 

```{r}
## Diabetes data
## Data path
dataSti <- "~/avid/bdr"
## Load all data årskontroll
DT <- readRDS(file.path(dataSti, "dt2018medBlodTrykk.RDS"))
## Load all data nyoppdaget
DTny <- readRDS(file.path(dataSti, "nyoppdaget20180830.rds"))

utDT <- selectdiab(DT)
utDT[, valg := 1L] # årskontroll
utDTny <- selectdiab(DTny)
utDTny[, valg := 2L] #nyoppdaget

DT2018 <- rbindlist(list(utDT, utDTny))

## alder rund tall og floor verdi dvs. 4.9 skal blir 4 år
DT2018[, age := as.integer(floor(alder))]

## Kjonn
DT2018[.(Kjonn = c("Gutt", "Jente"), to = 1:2), on = "Kjonn", kjonn := i.to]

```

# Kobling SSB og Diabetes data

Legger inn fylkeID i diabetesdata og hospID i SSB data. Ikke bruk *hosKort* for merged data *(DT2018)* fordi de inneholder
forskjellige sykehus forkortelse *(hosKort)* på samme sykehus. bruke **BARE** variable *hospID*.


```{r}

sykehusList <- utDT[, .N, keyby = .(hosKort, hospID)][, N := NULL][]
sykehusList

## Kobling sykehus og fylke
sykort <- sykehusList[["hosKort"]]
## sykort
sykID <- data.table(hosKort = sykort)
sykID[, id := .I] #midlertidig id til kobling mot fylke
sykDumID <- sykID[sykehusList, on = "hosKort"]

## Slett hosKort pga. forskjellige forkortelse navn på sammme sykehus
## og for å merge med sykDumID eller blir det konflikt hvis hosKort er på begge datasettet
DT2018[, hosKort := NULL]

## Gir Diabetes data fylkes id
DT2018Fyk <- sykDumID[DT2018, on = "hospID"]

DT2018Fyk[id == 1, fylkeid := 2] %>%
  .[id == 2, fylkeid := 9] %>%
  .[id == 3, fylkeid := 18] %>%
  .[id == 4, fylkeid := 6] %>%
  .[id == 5, fylkeid := 4] %>%
  .[id == 6, fylkeid := 20] %>%
  .[id == 7, fylkeid := 14] %>%
  .[id == 8, fylkeid := 5] %>%
  .[id == 9, fylkeid := 19] %>%
  .[id == 10, fylkeid := 11] %>%
  .[id == 11, fylkeid := 12] %>%
  .[id == 12, fylkeid := 10] %>%
  .[id == 13, fylkeid := 15] %>%
  .[id == 14, fylkeid := 50] %>%
  .[id == 15, fylkeid := 5] %>%
  .[id == 16, fylkeid := 15] %>%
  .[id == 17, fylkeid := 50] %>%
  .[id == 18, fylkeid := 19] %>%
  .[id == 19, fylkeid := 18] %>%
  .[id == 20, fylkeid := 11] %>%
  .[id == 21, fylkeid := 8] %>%
  .[id == 22, fylkeid := 50] %>%
  .[id == 23, fylkeid := 3] %>%
  .[id == 24, fylkeid := 7] %>%
  .[id == 25, fylkeid := 15] %>%
  .[id == 26, fylkeid := 1]


## saveRDS(DT2018Fyk, "DiabFylke.RDS")
saveRDS(DT2018Fyk, (file.path(dataSti, "alleDiabetes2018_med_fylkeid.Rds")))

```

## Annonymisering av diabetes data

Til offentlig bruk 


```{r}

## Annonymisering
dt2018ANON <- DT2018[, .(alder, age, Kjonn, kjonn, diabType, dbtype, fylkeid, hospID, valg)]
## saveRDS(dt2018ANON, "dtAnnonym.rds")
## saveRDS(dt2018ANON, file.path(dataSti, "AnnonymDBtypeFylkeID.rds"))

```

# Norgeskart

Les kart fra shapefile og konvertere til simple feature (sf) format.


```{r}
#kart fylke
NorgeMap = sf::st_read("~/Git-personal/Rujukan-R/norge/NOR_adm1.shp", stringsAsFactors = FALSE)

```

Endring av navn og fylkesfordeling dvs. Østfold og Trøndelag. To nye kolloner lages:

 - mapID : for nye sammenslåing av fylker
 - region : for nye navn av fylke ie. Trøndelag fra Nord- og Sør-Trøndelag


```{r}
## bytte Åstfold to Østfold
library(dplyr)
NorgeMap <- NorgeMap %>%
  mutate(NAME_1, fylke=ifelse(ID_1==1, 'Østfold', NAME_1))


## sør- og nord Trøndelag slår sammen siden jan 2018 - gi kode 50
## siden kode fra SSB for Trøndelag er 50
NorgeMap <- NorgeMap %>%
  mutate(ID_1, mapID = ifelse(ID_1 %in% c(9, 14), 50, ID_1))

## gir navn som Trøndelag
NorgeMap <- NorgeMap %>%
  mutate(fylke, region=ifelse(mapID==50, 'Trøndelag', fylke))

## saveRDS(NorgeMap, "kartNorge_sf.RDS")
```

## Gruppere fylke

Nord og Sør-Trøndelag slåss sammen til Trøndelag fra jan 2018. Bruk *mapID* og
*region* til gruppering. Disse må grupperes på nytt på kartet.

```{r}
norge2018 <- NorgeMap %>%
  group_by(mapID, region) %>%
  summarize()

## saveRDS(norge2018, "NorgeMapFylkeID.Rds")


```

Sjekk hvordan det ser ut nå


```{r}
## gamle kart med Sør-og Nord-Trøndelag
mapView(NorgeMap, zcol = 'fylke')

## nye kart med bare Trøndelag
norgeMapFylkeNY <- readRDS("NorgeMapFylkeID.Rds")
mapView(norgeMapFylkeNY, zcol = 'region')
```


# Legger mapID i SSB data

Fylke ID fra SSB data er ikke det samme ID som er fra kart så de må samkjøres først.


```{r}
norskBF[fylkeID == 1, mapID := 1] %>%
  .[fylkeID == 2, mapID := 2] %>%
  .[fylkeID == 3, mapID := 12] %>%
  .[fylkeID == 4, mapID := 6] %>%
  .[fylkeID == 5, mapID := 11] %>%
  .[fylkeID == 6, mapID := 4] %>%
  .[fylkeID == 7, mapID := 19] %>%
  .[fylkeID == 8, mapID := 16] %>%
  .[fylkeID == 9, mapID := 3] %>%
  .[fylkeID == 10, mapID := 18] %>%
  .[fylkeID == 11, mapID := 13] %>%
  .[fylkeID == 12, mapID := 7] %>%
  .[fylkeID == 14, mapID := 15] %>%
  .[fylkeID == 15, mapID := 8] %>%
  .[fylkeID == 16, mapID := 14] %>%
  .[fylkeID == 17, mapID := 9] %>%
  .[fylkeID == 18, mapID := 10] %>%
  .[fylkeID == 19, mapID := 17] %>%
  .[fylkeID == 20, mapID := 5] 

## saveRDS(norskBF, "SSBmedMapID.Rds")
ssbKart <- readRDS("SSBmedMapID.Rds")


```


## Legger helseforetaket

### Legge HF i kart data.

```{r}

norgeMapFylkeNY <- readRDS("NorgeMapFylkeID.Rds")

## Legger til HF
hso <- c("Østfold", "Akershus", "Aust-Agder", "Buskerud", "Hedmark", "Oppland", "Oslo", "Telemark", "Vest-Agder", "Vestfold")
hsv <- c("Hordaland", "Rogaland", "Sogn og Fjordane")
hsm <- c("Møre og Romsdal", "Trøndelag")
hsn <- c("Finnmark", "Nordland", "Troms")


NorgeHF <- norgeMapFylkeNY %>%
  mutate(region, helsereg = ifelse(region %in% hso, 1, ifelse(region %in% hsm, 2, ifelse(region %in% hsv, 3, 4))))

## Kart med helseforetaket
## saveRDS(NorgeHF, "NorgeFylkeHF_id.Rds")


## dekningsgrad BDR
kart_sf <- kart_sf %>%
  mutate(helsereg, helsenavn =
                     ifelse(fylke == 1, "Helse Sør-Øst",
                       ifelse(fylke == 3, "Helse Vest",
                         ifelse(fylke == 2, "Helse Midt", "Helse Nord")))) %>%
  mutate(helsereg, dekning =
                     ifelse(fylke == 1, 99,
                       ifelse(fylke == 2, 98,
                         ifelse(fylke == 3, 98, 97))))


## Merge kart på HF
kartmHF <- NorgeHF %>%
  group_by(helsereg) %>%
  summarise()

mapView(kartmHF)

## saveRDS(kartmHF, "KartHF.rds")

```

### Legger HF i BDR annonym data 


```{r}

dt1 <- DTannon

#Helse Foretaket
dt1[hospID  %in% c(22, 1, 25, 13, 18, 20, 21, 19, 16, 15, 14), rhf := 1] #Hels S-Ø
dt1[hospID  %in% c(11, 17, 26, 7, 8, 9), rhf := 2] #Helse Midt
dt1[hospID %in% c(12, 3, 4, 2), rhf := 3] #Helse Vest
dt1[hospID  %in% c(10, 23, 6, 5, 24), rhf := 4]

rhfNavn <- c("Helse Sør-Øst", "Helse-Midt", "Helse-Vest", "Helse-Nord")
dt1[.(rhf = 1:4, to = rhfNavn), on = "rhf", rhfNavn := i.to]


## saveRDS(dt1, "DTannonHF.rds")

```



# Antall barn i Norge

Kun barn fra 0 til 14 år.


```{r}

## Antall all per fylker
nbf <- grep("^Personer", names(ssbKart), value = T) #antall befolkningen
MapSsb <- ssbKart[, .(fylkeID, mapID, age, kjonn, N = get(nbf))]
## saveRDS(MapSsb, "Data_withID_MapSSB.rds")


NokBF <- ssbKart[, .(N = sum(N, na.rm = TRUE)),
                 keyby = .(fylkeID, mapID)][N != 0, ][]

## Antall per kjønn
KjonnBF <- ssbKart[, .(N = sum(N, na.rm = TRUE)),
                   keyby = .(kjonn, fylkeID, mapID)][N != 0, ][]

## Antall per alder
AgeBF <- ssbKart[, .(N = sum(N, na.rm = TRUE)),
                 keyby = .(age, fylkeID, mapID)][N != 0, ][]

## Antall per alder og kjonn
AgeKjonnBF <- ssbKart[, .(N = sum(N, na.rm = TRUE)),
                      keyby = .(kjonn, age, fylkeID, mapID)][N != 0, ][]


```



# Antall pasient per fylker 

Antall pasienter med alle type diabetes og speisfike type. KUN barn under 15 år.

```{r}
## DT2018 <- DT2018Alle
dt2018 <- subset(DT2018, alder < 15)
## dt2018[.(Kjonn = c("Gutt", "Jente"), to = 1:2), on = "Kjonn", kjonn := i.to]

dt2018 <- DTannon

## Alle type DT
dtFD <- dt2018[, .N, keyby = .(fylkeid)]
dtKjonnFD <- dt2018[, .N, keyby = .(kjonn, fylkeid)]
dtAgeFD <- dt2018[, .N, keyby = .(alder, fylkeid)]
dtAgeKjonnFD <- dt2018[, .N, keyby = .(kjonn, alder, fylkeid)]

## Type 1
dt1FD <- dt2018[dbtype == 1, .N, keyby = fylkeid]
dt1KjonnFD <- dt2018[dbtype == 1, .N, keyby = .(kjonn, fylkeid)]
dt1AgeFD <- dt2018[dbtype == 1, .N, keyby = .(alder, fylkeid)]
dt1AgeKjonnFD <- dt2018[dbtype == 1, .N, keyby = .(kjonn, alder, fylkeid)]


## Type 2
dt2FD <- dt2018[dbtype == 2, .N, keyby = fylkeid]
dt2KjonnFD <- dt2018[dbtype == 2, .N, keyby = .(kjonn, fylkeid)]
dt2AgeFD <- dt2018[dbtype == 2, .N, keyby = .(alder, fylkeid)]
dt2AgeKjonnFD <- dt2018[dbtype == 2, .N, keyby = .(kjonn, alder, fylkeid)]

```

# Prevalence per fylke 

Lager function for å regne prevalence per 10,000 og prosent.


```{r}

## mapID
fylkeList <- readRDS("FylkeogKartID.Rds")
fylkeList[, .N, by = .(fylke, kartID, mixID)]

# prevalens
preCount <- function(x, y, per = 100, col = "prev", digit = 2){

  ##per: per 100 person osv.
  ## x = DB data
  ## y = fylke data
  ## col: colnavn for prevalense eller insidens
  ## digit: for round digits
  
  preDT <- x[y, on = c(fylkeid = "fylkeID")]

  preDT[, ins  := N / i.N * per]

  ## columns for fylkeid og mapID
  utCol <- grep("id$", names(preDT), ignore.case = TRUE)

  tabCol <- names(preDT)[-utCol]
  tabName <- c("Case", "Populasjon", col)
  setnames(preDT, tabCol, tabName)

  preDT[, (tabName) := lapply(.SD, function(x1) round(x1, digits = digit)),
    .SDcols = tabName]

  preDT[is.na(mapID), mapID := 50] #for Trøndelag
  return(preDT)
}


```

## Funksjon med byid som brukes i interaktiv

```{r}

## function
preCountID <- function(x, y, byid = "fylkeid"){
  
  ## x = DB data
  ## y = fylke data
  preDT <- merge(x, y, by = byid)

  preDT[, ins10 := round(N.x / N.y * 10000, digits = 1)] %>%
    .[, ins := round(N.x / N.y * 100, digits = 3)]

  if (byid == "fylkeid"){
    ## columns for fylkeid og mapID
    utCol <- grep("id$", names(preDT), ignore.case = TRUE)
    tabCol <- names(preDT)[-utCol]
  }

  if (byid == "rhf"){ tabCol = names(preDT)[-1]}

  tabName <- c("Case", "Populasjon", "pr.10000", "pr.100")
  setnames(preDT, tabCol, tabName)

  ## preDT[, (tabName) := lapply(.SD, function(x1) round(x1, digits = 1)),
  ##   .SDcols = tabName]
  
  if (byid == "fylkeid"){
    preDT[is.na(mapID), mapID := 50] #for Trøndelag
  }

  return(preDT)
}

```



## Alle typer

Antall barn med diabetes av alle typer per 10 000 *ins10*.

```{r}

preDT <- preCount(dtFD, NokBF)[]
preDT

```

## Typer 1 


```{r}

preDT1 <- preCount(dt1FD, NokBF)[]
preDT1


kartDT1 <- norgeMapFylke %>% left_join(preDT1, by = c("mapID" = "kartID"))

dt1map1 <- mapView(kartDT1, zcol = "pr10000")
dt1map1
htmlwidgets::saveWidget(dt1map1, file = "T1Dpre.html")
mapshot(dt1map1, url = "T1Dpre.html")

```

# Insidens


```{r}
ssbKart
DTannon

insPas <- DTannon[valg == 2, .(n = .N), keyby = .(fylkeid)]
sykPas <- DTannon[valg == 1, .(ut = .N), keyby = .(fylkeid)]
sykPas
insPas

insDT <- merge(insPas, sykPas, by = "fylkeid", all = TRUE)

ssbDT <- ssbKart[, .(pop = sum(N, na.rm = T)), keyby = .(fylkeID, mapID)]
ssbDT

insLand <- merge(insDT, ssbDT, by.x = "fylkeid", by.y = "fylkeID", all.y = TRUE)
insLand
tabIns <- insLand[pop != 0, ]
tabIns[is.na(mapID), mapID := 50]
tabIns[, denom := pop - ut]
tabIns[, `:=`(ins = n / denom * 100, ins10 = n / denom * 10000), by = fylkeid]
tabIns

n = tabIns[, sum(n, na.rm = T)]
N = tabIns[, sum(denom, na.rm = T)]

n / N * 100000

utKart <- NorgeMapFylke %>% left_join(tabIns, by = "mapID")
utKart


```


# Kart: Prevalens og Insidens T1D


```{r}
## Antall i befolkning
NokBF <- ssbKart[, .(N = sum(N, na.rm = TRUE)),
                 keyby = .(fylkeID, mapID)][N != 0, ][]

## Type 1 for bare 0-14 år
dt14 <- subset(DTannon, age < 15)
dt14[, .N, keyby = age]
dt1FD <- dt14[dbtype == 1, .N, keyby = fylkeid]


## Tabell
tabT1D <- preCount(dt1FD, NokBF, per = 10000, col = "prev", digit = 1)
tabT1D[]

## gir fylkesnavn
tab1fyl <- merge(fylID, tabT1D, by = "mapID")
tab1fyl

## Gir text columns
tab1fyl[, txt := paste0(region, " (", prev, ")")]

## tar bort col region siden det finnes på kartet allerede
tab1fyl[, region := NULL]

## convert to tbl_df
library(tibble)
tab1TB <- as_tibble(tab1fyl)
tab1TB

```

## Koble dataene til kart



```{r}
# merge kart og data
kartT1D <- NorgeMapFylke %>% left_join(tab1fyl, by = "mapID")
kartT1D

## basic map
library(ggplot2)
tk1 <- ggplot(kartT1D, aes(fill = region)) + geom_sf()
tk1

## with added features
tk2 <- tk1 +
  scale_fill_viridis_d() + #for viridis discrete data
  coord_sf(crs = 4326, datum = sf::st_crs(4326)) + #legger CRS coordinate for å korrigere kart
  ggtitle("Prevalens T1D pr. 10,000 barn mellom 0-14 år") +
  theme(title = element_text(size = 16))

tk2

## add points for kart
kart_centroid <- kartT1D %>% sf::st_centroid() #create point
kart_centroid

tk2 + geom_sf(data = kart_centroid, aes(fill = region), colour = "red")

# get coordinate for fylke dvs. X og Y for å lage text
fylKord <- cbind(kart_centroid, st_coordinates(st_centroid(kartT1D)))
fylKord






## unngår tekst overlapper
library(ggrepel)

tk2 + geom_text_repel(data = fylKord, aes(X, Y, label = txt),
  size = 5, nudge_x = -2 - -8, direction = "y") +
  coord_sf()

## alternativ

## de skal være i riktig rekkefølge!!
nordned = c(5, 10, 17, 50) # Finnmark, Nordland, Troms, Trøndelag
vest = c(7, 8, 13, 15) # Hordaland, Møre, Rogaland,Sogn
ssor = c(3, 16, 18, 19) # Aust-Agd, Telemark, Vest-Agder, Vestfold
sopp = c(4, 6, 11) #Buskerud, Hedemark, Oppland
oslo = c(1, 2, 12) # ØStfold, Akershus, Oslo

d1tKart <- tk2 +
  geom_text_repel(data = subset(fylKord, mapID  %in% nordned), aes(X, Y, label = txt),
    fontface = "bold", size = 4, nudge_x = c(2, 2, 2, -3), nudge_y = c(-1.5, -1.5, -1.5, 1)) +
  geom_text_repel(data = subset(fylKord, mapID  %in% vest), aes(X, Y, label = txt),
    size = 4,  fontface = "bold", nudge_x = c(-3.5, -3, -3, -8), nudge_y = c(0.25, 0.5, 0.25, 1)) +
  geom_text_repel(data = subset(fylKord, mapID  %in% ssor), aes(X, Y, label = txt),
    size = 4,  fontface = "bold", nudge_x = c(2, 4, -3, 1), nudge_y = c(-1, -1, -0.15, -1)) +
  geom_text_repel(data = subset(fylKord, mapID  %in% sopp), aes(X, Y, label = txt),
    size = 4,  fontface = "bold", nudge_x = c(5.5, 3, 5), nudge_y = c(0.5, 0.25, 1.5)) +
  geom_text_repel(data = subset(fylKord, mapID  %in% oslo), aes(X, Y, label = txt),
    size = 4,  fontface = "bold", nudge_x = c(2.5, 4, 3), nudge_y = c(-0.1, 0.25, -0.2)) +
  coord_sf(xlim = c(0, 35), ylim = c(56, 73), expand = FALSE) +
  theme_minimal() +
  theme(
    legend.position = "none",
    panel.grid = element_blank(),
    panel.border = element_blank(),
    axis.text = element_blank(),
    axis.title = element_blank()
    )

## ggsave("kartT1D0til14.png")
ggsave("kartDiab1for0Til14.png", plot = d1tKart)

```



